<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bootstrap 3 Tutorial from BootstrapBay.com">
    <meta name="author" content="BootstrapBay.com">
    <title>Verarbeitung</title>
    
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
 </head>
 
 <body onload="start()">
 	<script type="text/javascript" >
 	
 		$(document).ready(function() {
            $('#navbar').load('navbar.html');
            $('#footer').load('footer.html');
            $("#buttonBestätigung").click(function(){
                
                produziere(mengeProdukt, maschinenid);
            });
        });
 		
 		var daten;
 		var mengeProdukt;
 		var maschinenid;

 		window.onload = function getDataVerarbeitung(){
			jQuery.ajax({
				url: "../webapi/v1/demo/unternehmen",
				type: "GET",
				dataType: "json",
				success: function(data, data2){
					daten = data.mmarkt.angebote;
					printVerarbeitung(daten);
					
				}
			});
		}
 		
 		//var c ="";
		function printVerarbeitung(data){
			//for (String key : data[angebot].markteinheit.matrix.matrix.keySet()) {
	 		//    c = key;
	 		//    console.log(key);
	 		//}
			var verarbData = data;
			var cont  = document.getElementById('contentVerarbeitung');
			var s ="";
			for(var angebot in data){
				maschinenid = data[angebot].markteinheit.id;
				var inputid = "inputVerarbeitung"+maschinenid;
				var outputid = "demo"+maschinenid;
				
				s += '<div class="col-sm-6 col-md-4"><div class="thumbnail">'+
						'<img src="img/leder.jpg" alt="Leder">'+
						'<div class="caption">'+
							'<div class="col-sm-12">'+
								'<h3>'+ data[angebot].markteinheit.p.name+'</h3>'+
							'</div>'+
							'<div class="col-sm-12">'+
								'<h4>Benötigtes Material:</h4>'+
							'</div>'+
							'<div class="col-sm-6">'+
								'<p>Leer</p>'+
							'</div>'+
							'<div class="col-sm-6">'+
							//	'<p>'+ c +'</p>'+
								'<p>Leer</p>'+
							'</div>'+
							
							'<div class="col-sm-12">'+
								'<h4>Maschine:</h4>'+
							'</div>'+
							'<div class="col-sm-6">'+
								'<p>Benötigte Kapazität</p>'+
							'</div>'+
							'<div class="col-sm-6">'+
								'<p>'+ data[angebot].menge+'</p>'+
								
							'</div>'+	
							'<div class="col-sm-12">'+
								'<h4>Sonstige Kosten:</h4>'+
							'</div>'+
							'<div class="col-sm-6">'+
								'<p>Fertigungskosten: </p>'+
							'</div>'+
							'<div class="col-sm-6">'+
								'<p>'+ data[angebot].markteinheit.fertigungskosten+'</p>'+
								'<br>'+
							'</div>'+	
							
		    				'<div class="col-sm-3">'+
								'<input class="form-control input-sm" type="text" id ='+ inputid+'>'+
								'<br>'+
							'</div>'+
							'<div class="col-sm-3">'+
								'<p>Stück</p>'+
								'<br>'+
							'</div>'+
							'<div class="col-sm-4">'+
								'<a href="#" class="btn btn-danger" onClick = "produziereMeldung('+maschinenid+','+angebot+')" data-toggle="modal" data-target="#modalProduzieren">Produzieren</a>'+
								'<br>'+
							'</div>'+
							
							
							'<div class="col-sm-12">'+
							'<p id='+outputid+'>Test</p>'+
							'</div>' +
						'</div>' + 
						'</div></div></div>';
				
			}
			cont.innerHTML = s;
		}
		
		// Bei Klick auf Button "Produziere"
		function produziereMeldung(id, angebot) {
			
			// Wert des Input-Feldes (Menge, die produziert werden soll)
			var iV = document.getElementById("inputVerarbeitung"+id).value;
			
			if (isNaN(iV) || iV < 1 ) {
				var cont  = document.getElementById('contentModal');
		        text = "Eingabe ungültig!";
		        cont.innerHTML = text;
		        return;
		    } else {
		        text = iV;
		    }
		   // document.getElementById("demo").innerHTML = text;
			
			//Test: Input-Wert
			document.getElementById("demo"+id).innerHTML = text;
			
			//Inhalt des Modal
			var cont  = document.getElementById('contentModal');
			var s ="";
			
			//Multipliziere mit eingebener Menge
			var menge = daten[angebot].menge;
			menge *= iV;
			var kosten = daten[angebot].markteinheit.fertigungskosten;
			kosten *= iV;
			
				s += 
					'<div class="col-sm-12">'+
						'<h3>Produktion von ' +iV+'x ' +  daten[angebot].markteinheit.p.name +':</h3><div><br></div>'+
					'</div>'+
					
					'<div class="col-sm-12">'+
						'<h4>Benötigtes Material:</h4>'+
					'</div>'+
					
					'<div class="col-sm-6">'+
						'<p>Leer</p>'+
					'</div>'+
					'<div class="col-sm-6">'+
						'<p>Leer</p>'+
					'</div>'+
					
					'<div class="col-sm-12">'+
						'<h4>Maschine:</h4>'+
					'</div>'+
					'<div class="col-sm-6">'+
						'<p>Benötigte Kapazität:</p>'+
					'</div>'+
					'<div class="col-sm-6">'+
						'<p>'+ menge +'</p>'+
					'</div>'+	
					
					'<div class="col-sm-12">'+
						'<h4>Sonstige Kosten:</h4>'+
					'</div>'+
					'<div class="col-sm-6">'+
						'<p>Fertigungskosten: </p>'+
					'</div>'+
					'<div class="col-sm-6">'+
						'<p>'+ kosten+'</p>'+
						'<br>'+
					'</div>'
					 ;
		
				cont.innerHTML = s;
				
				mengeProdukt = iV;
		}
		
		function produziere(mengeProdukt, maschinenid) {
	 		jQuery.ajax({
		 		url: "../webapi/v1/demo/produziere/"+mengeProdukt+"/"+maschinenid,
		 		type: "GET",
		 		dataType: "json",
		 		sucess: function(data, data2) {
		 			confirm("Produktion abgeschlossen");
		 			location.reload(true);
		 		}
	 		})
	 	}
		
	</script>

    <!-- Fixed navbar -->
    <div id="navbar">
	</div>
    
	<!-- Page Header -->
	<div class="container">	
        <div class="page-header">
             <h1>Herstellung von Produkten</h1>
        </div>
        
   	<!-- Page Content -->
        <div class="well">
        		<div class="row" id="contentVerarbeitung">
        		
  				</div>
  		</div>
		<br>
	</div>	
	
	<!-- The Modal -->
  <div class="modal" id="modalProduzieren">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
         <div id="contentModal">
          </div>
        <!-- Modal body -->
        <div class="modal-body" >
         
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer" >
          <button type="button" class="btn btn-danger" data-dismiss="modal" id="buttonBestätigung">Bestätigen</button>
        </div>
        
      </div>
    </div>
  </div>

    <!-- Fixed footer -->
    <div id="footer">
	</div>
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <div class="modal fade" id="contact" role="dialog">
    	<div class="modal-dialog">
    		<div class="modal-content">
    			<form class="form-horizontal" role="form">
    				<div class="modal-header">
    					<h4>Contact<h4>
	    			</div>
	    			<div class="modal-body">
    					<div class="form-group">
    						<label for="contact-name" class="col-sm-2 control-label">Name</label>
    						<div class="col-sm-10">
    							<input type="text" class="form-control" id="contact-name" placeholder="First & Last Name">
    						</div>
    					</div>
    					<div class="form-group">
    						<label for="contact-email" class="col-sm-2 control-label">Email</label>
    						<div class="col-sm-10">
    							<input type="email" class="form-control" id="contact-email" placeholder="example@domain.com">
    						</div>
    					</div>
    					<div class="form-group">
    						<label for="contact-message" class="col-sm-2 control-label">Message</label>
    						<div class="col-sm-10">
    							<textarea class="form-control" rows="4"></textarea>
    						</div>
    					</div>
	    			</div>
	    			<div class="modal-footer">
    					<a class="btn btn-default" data-dismiss="modal">Close</a>
    					<button type="submit" class="btn btn-primary">Send</button>
    				</div>
    			</form>
    		</div>
    	</div>
    </div>
    
   
  
  </body>
</html>