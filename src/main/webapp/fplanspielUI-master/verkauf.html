<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bootstrap 3 Tutorial from BootstrapBay.com">
    <meta name="author" content="BootstrapBay.com">
    <title>Verkauf</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
 </head>
 
 <body onload="start()">
 		<script type="text/javascript" >
 			$(document).ready(function() {
                $('#navbar').load('navbar.html');
                $('#footer').load('footer.html');
                });
 			
 			
 			window.onload = getDataVerkauf();
 			
 			function getDataVerkauf(){
 				jQuery.ajax({
 					url: "../api/spiel/produkte",
 					type: "GET",
 					dataType: "json",
 					success: function(data, data2){
 						printBestandP(data.produkte);
 						
 					}
 				});
 				
 				jQuery.ajax({
 					url: "../api/spiel/vmarkt",
 					type: "GET",
 					dataType: "json",
 					success: function(data, data2){
 						printAngebote(data.angebote);
 						
 					}
 				});
 			}
 			
 			 			
 			//Neues Objekt Dictionary
 			var dict = {};
 			var INDEX = 0;
 			
 			
 			function printBestandP(data){
 				var cont  = document.getElementById('contentBestandP');
 				var contSel = document.getElementById('contentSelect');
 				var s1 ="";
 				var s2 ="";
 				for(var produkt in data){
 					//name = data[produkt].p.name;
 					vorhandeneMenge = data[produkt].menge;
 					s1 += 	'<li class="list-group-item">'+ data[produkt].p.name+
 								'<span class="badge">'+
 								 data[produkt].menge+
 								'</span>'+
 							'</li>';
 							
 					s2 += '<option>'+data[produkt].p.name+'</option>'
 					
 					dict[ data[produkt].p.name ] = data[produkt].p.id;
 					
 					
 				}
 				cont.innerHTML = s1;
 				contSel.innerHTML = s2;
 				
 				for(var key in dict) {
		 				var value = dict[key];
		 				
		 				console.log(value + " Eintrag in das Dict"+ INDEX);
		 				INDEX ++;
		 			}
					INDEX=0;
 				
 			}
 			
 			function printAngebote(data) {
 				var cont = document.getElementById('contentAngebote');
 				var s ="";
 				var angebotsid;
 				for(var angebot in data){
 					angebotsid = data[angebot].id;
 					s += '<div class="col-sm-6 col-md-4"><div class="thumbnail">'+
						
						'<div class="caption">'+
							'<div class="col-sm-12">'+
								'<h4>Angebot '+angebotsid+'</h4>'+
							'</div>'+
							'<br>'+
							'<div class="col-sm-6">'+
								'<p>'+data[angebot].markteinheit.name+'</p>'+
							'</div>'+
							'<div class="col-sm-3">'+
								'<p>'+ data[angebot].menge+'</p>'+
							'</div>'+
							'<div class="col-sm-3">'+
								'<p>Stück</p>'+
							'</div>'+
										
							'<div class="col-sm-6">'+
								'<p>Preis</p>'+
							'</div>'+
							'<div class="col-sm-3">'+
								'<p>'+ data[angebot].preis+'</p>'+
							'</div>'+
							'<div class="col-sm-3">'+
								'<p>€</p>'+
								
							'</div>'+
							'<div class="col-sm-6">'+
							'</div>'+
							'<div class="col-sm-6">'+
								'<button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modalVerkauf" onClick="angebotEntfernenModal('+angebotsid+')">Angebot entfernen</button>'+
								'<br>'+
							'</div>'+
						'</div>' + 
 						'</div></div></div>';
 				}
 				cont.innerHTML = s;
 			}
 			
 			function anbieten() {
 				var menge = document.getElementById("inputMenge").value;
 				var preis = document.getElementById("inputPreis").value;
 				var meldung  = document.getElementById('label');
 				
 				//Auslesen des Optionsfelds
 				var optionField =  document.getElementById("contentSelect");
 				var sIndex = optionField.selectedIndex; //Startet bei 0
 				var x = optionField.options[sIndex].text;
 				
 				var value = dict[x];
		 		console.log(value + " Ausgabe der ID");
		 			
 				
 				if (isNaN(menge) || isNaN(preis) || menge < 1 ){
 			        var text = "<h6>&nbsp;&nbsp;Nicht genug Produkte vorhanden!</h6>";
 			        meldung.innerHTML = text;
 			        return;
 				}
 				
 				var text = "";
			    meldung.innerHTML = text;
			    
 				jQuery.ajax({
 					url: "../api/spiel/anbieten?menge=" + menge + "&produktid=" + value + "&preis=" + preis,
 					type: "GET",
 					dataType: "json",
 					success: function(data, data2){
 						getDataVerkauf();
 						console.log("Menge wurde verringert");
 					}
 				});
 			
 			}
 			
 			function angebotEntfernenModal(angebotsid) {
 				var cont  = document.getElementById('contentModalVerk');
 				
 				//Einbauen: If mit Index -> Maschinen und Mitarbeiter sind ebenfalls angebote, die entfernt werden?
 				
 				var s ='<div class="col-sm-12">'+
				'<h3>Angebot'+angebotsid+' </h3><div><br></div>'+
				'</div>'+
				'<div class="col-sm-12">'+
					'<h4>Möchten Sie das Angebot wirklich entfernen?</h4>'+
				'</div>'+
				
				'<div class="row">'+
					'<div class="col-sm-9">'+
					'</div>'+
					'<div class="col-sm-3">'+
						'<button type="button" class="btn btn-danger" data-dismiss="modal" onClick="angebotEntfernen('+angebotsid+')">Bestätigen</button>'+
					'</div>'+
				'</div>';
				
				cont.innerHTML = s;
			
 			}
 			
 			function angebotEntfernen(angebotsid) {
 				
 				jQuery.ajax({
 					url: "../api/spiel/angebotentfernen?id=" + angebotsid,
 					type: "GET",
 					dataType: "json",
 					success: function(data, data2){
 						
 						console.log("Angebot entfernt");
 					}
 				});
 				getDataVerkauf();
 				
 			}
 			 

		</script>

    <!-- Fixed navbar -->
    <div id="navbar">
	</div>
    
	<!-- Page Header -->
	<div class="container">	
        <div class="page-header">
            <h1>Verkauf</h1>
        </div>
        
        <div class="page-header">
            <h2>Angebote</h2>
        </div>
		
		<div>
			<div class="col-sm-6"><h3>Bestand an Produkten:</h3></div>
			<div class="col-sm-6"><h3>Angebote einstellen:</h3></div>
		</div>
		
		<div class="row"><br></div>
		
		<!-- Liste des Produktbestandes -->
		<div class="row">
				<ul class="list-group col-sm-4" id = "contentBestandP">
				
				</ul> 
			<div class="col-sm-2 align-self-center"></div>
			<div class="col-sm-4 align-self-center">
				<div class="row">
				 	<div class="form-group">
				 
				 		<div class="col-sm-4 align-self-center">
  							  <label for="sel1">Produkt:</label>
  						</div>
  						<div class="col-sm-8 align-self-center">
  							 <select class="form-control" id="contentSelect">
							   
							  </select>
  						</div>
  						
					</div> 
				</div>
				
				<div class="row">
					<div class="form-group">
	  						<div class="col-sm-4 align-self-center">
	  							<label>Menge:</label>
	  						</div>
	  						<div class="col-sm-8 align-self-center">
	  							<input type="text" class="form-control" id="inputMenge">
	  						</div>
					</div>
				</div>
				
				<div class="row">
					<div class="form-group">
	  						<div class="col-sm-4 align-self-center">
	  							<label>Preis:</label>
	  						</div>
	  						<div class="col-sm-8 align-self-center">
	  							<input type="text" class="form-control" id="inputPreis">
	  						</div>
					</div>
				</div>
				<div class="row">
					<div class ="col-sm-4"></div>
					<div class ="col-sm-8">
						<div class="form-group">
		  						<label id="label"></label>
						</div>
					</div>
				</div>
 				
			</div>
			<div class="col-sm-1 align-self-center"></div>
			<div class="col-sm-2 align-self-end">
				<button type="button" class="btn" onClick="anbieten()">Neues Angebot einstellen</button>
			</div>
		</div>
		
		
		<!-- Bestehende Angebote -->
		<br>
		<div>
			<h3>Bestehende Angebote:</h3>
		</div>
		
		 <div class="well">
        		<div class="row" id="contentAngebote">
  				</div>
  		</div>
  		
  		<div class="page-header">
            <h2>Verkauf von Maschinen</h2>
        </div>
        
        <div class="well">
        		<div class="row" id="contentVKMaschinen">
  				</div>
  		</div>
  		
  		<div class="page-header">
            <h2>Kündigen von Mitarbeitern</h2>
        </div>
        
        <div class="well">
        		<div class="row" id="contentVKMitarbeiter">
  				</div>
  		</div>
	</div>
	
	<!-- The Modal -->
  <div class="modal" id="modalVerkauf">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
         <div class="modal-body" id="contentModalVerk">
          </div>
       
        
      </div>
    </div>
  </div>

    <!-- Fixed footer -->
    <div id="footer">
	</div>
        
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>