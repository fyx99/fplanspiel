<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bootstrap 3 Tutorial from BootstrapBay.com">
    <meta name="author" content="BootstrapBay.com">
    <title>Beschaffung</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>  
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.min.js"></script>
    <link href="css/custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>

 </head>
 
 <body onload="start()">
 		<script type="text/javascript" >
 		
 			$(document).ready(function() {
                $('#navbar').load('navbar.html');
                $('#footer').load('footer.html');
                });
 			
 			var datenbMarkt;
 			var datenmMarkt;
 			var datenfMarkt;
 			
 	 		var mengeMaterial;
 	 		var mengeMaschine;
 			var mengeKredit;
 	 		
 	 		var maschinenid;
 	 		var materialid;
 	 		var kreditid;
 	 		
 			window.onload = getDataEinkauf();
 				
 				function getDataEinkauf(){
	 				jQuery.ajax({
	 					url: "../api/spiel/unternehmen",
	 					type: "GET",
	 					dataType: "json",
	 					success: function(data, data2){
	 						datenbMarkt=data.bmarkt.angebote;
	 						datenmMarkt=data.mmarkt.angebote;
	 						
	 						printMaterial(datenbMarkt);
	 						printMaschinen(datenmMarkt);
	 						console.log("Nach mMarkt");
	 					}
	 				});
	 				
	 				jQuery.ajax({
	 					url: "../api/spiel/fmarkt",
	 					type: "GET",
	 					dataType: "json",
	 					success: function(data, data2){
	 						datenfMarkt=data.angebote;
	 						printKredite(datenfMarkt);
	 					}
	 				});
	 				
	 				jQuery.ajax({
	 					url: "../api/spiel/mitarbeiter",
	 					type: "GET",
	 					dataType: "json",
	 					success: function(data, data2){
	 						
	 						printMitarbeiter(data);
	 					}
	 				});
	 				
	 				
 				}
 			
 			function printMaterial(data){
 				var cont  = document.getElementById('contentMaterial');
 				var s ="";
 				var bilder = ["img/holz.jpg", "img/stoff.jpg", "img/leder.jpg", "img/glas.jpg", "img/plastik.jpg", "img/edelstahl.jpg"];
 			    var index = 0;
 			    
 				for(var angebot in data){
 					materialid = data[angebot].markteinheit.id;
 					var inputid = "inputEinkauf"+materialid;
 					//var outputid = "demo"+materialid;
 					
 					s += '<div class="col-sm-6 col-md-4"><div class="thumbnail">'+
 							'<img src="' + bilder[index] +'" alt="' + data[angebot].markteinheit.name + '">' + 
 							'<div class="caption">'+
 								'<div class="col-sm-12">'+
 									'<h3>'+ data[angebot].markteinheit.name+'</h3>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>Preis pro ME in €</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].preis+'</p>'+
 								'</div>'+
 											
 								'<div class="col-sm-6">'+
 									'<p>Verfügbar</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].menge+'</p>'+
 									'<br>'+
 								'</div>'+		
 																
 		        				'<div class="col-sm-3">'+
 									'<input class="form-control input-sm" type="text" id ='+ inputid+'>'+
 									'<br>'+
 								'</div>'+
 								'<div class="col-sm-3">'+
 									'<p>Stück</p>'+
 									'<br>'+
 								'</div>'+
 								'<div class="col-sm-4">'+
 									'<a href="#" class="btn btn-danger" onClick = "kaufeModal('+materialid+','+angebot+',1)" data-toggle="modal" data-target="#modalKaufen">Kaufen</a>'+
 									'<br>'+
 								'</div>'+
 								
 								//'<div class="col-sm-12">'+
 								//'<p id='+outputid+'>Test</p>'+
 								//'</div>' +
 							'</div>' + 
 							'</div></div></div>';
 							index++;
 				}
 				cont.innerHTML = s;
 			}
 			
 			function printMaschinen(data){
 				
 				var cont  = document.getElementById('contentMaschine');
 				var s ="";
 				var bilder = ["img/maschineeins.jpg", "img/maschineeins.jpg", "img/maschineeins.jpg", "img/maschinezwei.jpg", "img/maschinezwei.jpg", "img/maschinezwei.jpg", "img/maschinedrei.jpg", "img/maschinedrei.jpg", "img/maschinedrei.jpg"];
 			    var index = 0;
 			    
 				for(var angebot in data){
 					
 					maschinenid = data[angebot].markteinheit.id;
 					var inputid = "inputEinkauf"+maschinenid;
 					//var outputid = "demo"+maschinenid;
 					
 					s += '<div class="col-sm-6 col-md-4"><div class="thumbnail">'+
 						'<img src="' + bilder[index] +'" alt="' + data[angebot].markteinheit.name + '">' + 
 							'<div class="caption">'+
 								'<div class="col-sm-12">'+
 									'<h3>'+ data[angebot].markteinheit.name+'</h3>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>Preis in €</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].preis+'</p>'+
 								'</div>'+
 											
 								'<div class="col-sm-6">'+
 									'<p>Verfügbar</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].menge+'</p>'+
 								'</div>'+
 								
 								'<div class="col-sm-6">'+
 								'<p>Kapazität</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].markteinheit.kapazitaet+'</p>'+
 									'<br>'+
 								'</div>'+	
 																
 		        				'<div class="col-sm-3">'+
 									'<input class="form-control input-sm" type="text" id ='+ inputid+'>'+
 									'<br>'+
 								'</div>'+
 								'<div class="col-sm-3">'+
 									'<p>Stück</p>'+
 									'<br>'+
 								'</div>'+
 								'<div class="col-sm-4">'+
 									'<a href="#" class="btn btn-danger"  onClick = "kaufeModal('+maschinenid+','+angebot+', 2)" data-toggle="modal" data-target="#modalKaufen">Kaufen</a>'+
 									'<br>'+
 								'</div>'+
 								//'<div class="col-sm-12">'+
 								//'<p id='+outputid+'>Test</p>'+
 								//'</div>' +
 							'</div>' + 
 							'</div></div></div>';
 							
 							index++;
 				}
 				cont.innerHTML = s;
 			}
 			

 			
 			function printKredite(data){
 				
 				var cont  = document.getElementById('contentKredite');
 				var s ="";
 				
 			    
 				for(var angebot in data){
 					
 					kreditid = data[angebot].markteinheit.id;
 					var inputid = "inputEinkauf"+kreditid;
 					//var outputid = "demo"+kreditid;
 					
 					s += '<div class="col-sm-6 col-md-4"><div class="thumbnail">'+
 						
 							'<div class="caption">'+
 								'<div class="col-sm-12">'+
 									'<h3>'+ data[angebot].markteinheit.name+'</h3>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>Preis in €</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].preis+'</p>'+
 								'</div>'+
 											
 								'<div class="col-sm-6">'+
 									'<p>Verfügbar</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].menge+'</p>'+
 									'<br>'+
 								'</div>'+
 								
 								'<div class="col-sm-6">'+
 								'<p>Laufzeit</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].markteinheit.laufzeit+'</p>'+
 								'</div>'+	
 								'<div class="col-sm-6">'+
 								'<p>Volumen</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].markteinheit.volumen+'</p>'+
 								'</div>'+	
 								'<div class="col-sm-6">'+
 								'<p>Zinssatz</p>'+
 								'</div>'+
 								'<div class="col-sm-6">'+
 									'<p>'+ data[angebot].markteinheit.zinssatz+'</p>'+
 									'<br>'+
 								'</div>'+	
 															
 		        				'<div class="col-sm-3">'+
 									'<input class="form-control input-sm" type="text" id ='+ inputid+'>'+
 									'<br>'+
 								'</div>'+
 								'<div class="col-sm-3">'+
 									'<p>Stück</p>'+
 									'<br>'+
 								'</div>'+
 								'<div class="col-sm-4">'+
 									'<a href="#" class="btn btn-danger"  onClick = "kaufeModal('+kreditid+','+angebot+', 3)" data-toggle="modal" data-target="#modalKaufen">Kaufen</a>'+
 									'<br>'+
 								'</div>'+
 								//'<div class="col-sm-12">'+
 								//'<p id='+outputid+'>Test</p>'+
 								//'</div>' +
 							'</div>' + 
 							'</div></div></div>';
 							
 							
 				}
 				cont.innerHTML = s;
 			}
 			
 			function printMitarbeiter(data){
 				var cont  = document.getElementById('contentMitarbeiter');
 				var s ="";
 				
				for(var angebot in data){
 					
 					s += '<div class="col-sm-6 col-md-4"><div class="thumbnail">'+
 					'</div></div>';
						
				}
				cont.innerHTML = s;
 			}
 			
 		// Bei Klick auf Button "Kaufen"
 			function kaufeModal(id, angebot, markt) {
 			
 			// Wert des Input-Feldes (Menge, die produziert werden soll)
 				var iV = document.getElementById("inputEinkauf"+id).value;
 			
 				if(markt == 1) {
 					markt = datenbMarkt;
 					mengeMaterial = iV;
 				}
 				if(markt == 2) {
 					
 					markt = datenmMarkt;
 					mengeMaschine = iV;
 				}
 				if(markt == 3) {
 					
 					markt = datenfMarkt;
 					mengeKredit = iV;
 				} 
 				
 				var text;
 				// Verfügbare Menge
 				var menge = markt[angebot].menge;
 				
 				// Prüfe, ob Eingabe die verfügbare Menge überschreitet oder ein negativer Wert eingegeben wird
 				if (isNaN(iV) || iV < 1 || iV > menge) {
 					var cont  = document.getElementById('contentModal');
 			        text = "<h3>&nbsp;&nbsp;Eingabe ungültig!</h3>";
 			        cont.innerHTML = text;
 			        return;
 			    } else {
 			        text = iV;
 			    }
 				
 				//Test: Input-Wert
 				//document.getElementById("demo"+id).innerHTML = text;
 				
 				//Inhalt des Modal
 				var cont  = document.getElementById('contentModal');
 				var s ="";
 				
 				//Multipliziere Preis mit eingebener Menge
 				var kosten = markt[angebot].preis;
 				kosten *= iV;
 				
 				var angebotsid = markt[angebot].id;
 				
 					s += 
 						'<div class="col-sm-12">'+
					'<h3>Kauf von ' +  markt[angebot].markteinheit.name +':</h3><div><br></div>'+
					'</div>'+
					'<div class="col-sm-12">'+
						'<h4>Menge: '+ iV+' Stück</h4>'+
					'</div>'+
					'<div class="col-sm-12">'+
					'<h4>Kosten: '+ kosten+' Euro</h4>'+
					'</div>'+
					'<div class="row">'+
						'<div class="col-sm-9">'+
						'</div>'+
						'<div class="col-sm-3">'+
							'<button type="button" class="btn btn-danger" data-dismiss="modal" onClick="kaufe('+iV+', '+angebotsid+')">Bestätigen</button>'+
						'</div>'+
					'</div>';
 			
 					cont.innerHTML = s;
 					
 					
 			}
 		
 			function kaufe(menge, id){
 				jQuery.ajax({
 			 		url: "../api/spiel/angebotkaufen?menge=" + menge + "&angebotsid=" + id,
 			 		type: "GET",
 			 		dataType: "json",
 			 		sucess: function() {
 			 			console.log("Success");
 			 			location.reload(true);
 			 			
 			 		
 				    }
 		 		});
 				
 				$('#navbar').load('navbar.html');
 				getDataEinkauf();
 				
 				
 			}

		</script>

    <!-- Fixed navbar -->
    <div id="navbar">
	</div>
    
	<!-- Page Header -->
	<div class="container">
	
        <div class="page-header">
            <h1>Beschaffung</h1>
            <!-- Sprungmarke für Navigation -->
  			<div id="materialien"></div>
            <br>
        </div>
        
        
      
        <div class="page-header">
            <h2>Materialien</h2>
        </div>
        
        <div class="well">
        		<div class="row" id="contentMaterial">
  				</div>
  		</div>
  		
  		<!-- Sprungmarke für Navigation -->
  		<div id="maschinen"></div>
  		<br>
  		<br>
  		
  		 <div class="page-header" >
            <h2>Maschinen</h2>
        </div>
        
        <div class="well">
        		<div class="row" id="contentMaschine">
  				</div>
  		</div>
  		
  		<!-- Sprungmarke für Navigation -->
  		<div id="kredite"></div>
  		<br>
  		<br>
  		
  		 <div class="page-header">
            <h2>Kredite</h2>
        </div>
        
        <div class="well">
        		<div class="row" id="contentKredite">
  				</div>
  		</div>
  		
  		<!-- Sprungmarke für Navigation -->
  		<div id="mitarbeiter"></div>
  		<br>
  		<br>
  		
  		 <div class="page-header">
            <h2>Mitarbeiter</h2>
        </div>
        
        <div class="well">
        		<div class="row" id="contentMitarbeiter">
  				</div>
  		</div>
		
		<br>
	</div>	

	<!-- The Modal -->
  <div class="modal" id="modalKaufen">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
         <div class="modal-body" id="contentModal">
          </div>
       
        
      </div>
    </div>
  </div>
    
   
    <!-- Fixed footer -->
    <div id="footer">
	</div>
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <div class="modal fade" id="contact" role="dialog">
    	<div class="modal-dialog">
    		<div class="modal-content">
    			<form class="form-horizontal" role="form">
    				<div class="modal-header">
    					<h4>Contact<h4>
	    			</div>
	    			<div class="modal-body">
    					<div class="form-group">
    						<label for="contact-name" class="col-sm-2 control-label">Name</label>
    						<div class="col-sm-10">
    							<input type="text" class="form-control" id="contact-name" placeholder="First & Last Name">
    						</div>
    					</div>
    					<div class="form-group">
    						<label for="contact-email" class="col-sm-2 control-label">Email</label>
    						<div class="col-sm-10">
    							<input type="email" class="form-control" id="contact-email" placeholder="example@domain.com">
    						</div>
    					</div>
    					<div class="form-group">
    						<label for="contact-message" class="col-sm-2 control-label">Message</label>
    						<div class="col-sm-10">
    							<textarea class="form-control" rows="4"></textarea>
    						</div>
    					</div>
	    			</div>
	    			<div class="modal-footer">
    					<a class="btn btn-default" data-dismiss="modal">Close</a>
    					<button type="submit" class="btn btn-primary">Send</button>
    				</div>
    			</form>
    		</div>
    	</div>
    </div>
    

  </body>
</html>