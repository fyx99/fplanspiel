<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Spiel starten</title>
   	<script src="jquery/jquery-1.11.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>   
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="start.html">Unternehmensplanspiel</a>		<!--zeigt auf start-->
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-default"></ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    
	<div class="container pt-5">

        <div class="page-header">
            <h1>Neues Spiel</h1>
        </div>	
            	<h3>Bitte wähle den Spielmodus, die Länge des Spiels und die Anzahl der Spieler aus!</h3>

                <style> 
                table {
                    font-family: arial, sans-serif;
                    border-collapse: collapse;
                    width: 100%;
                    }

                td, th {
                    border: 1px solid #dddddd;
                    text-align: left;
                    border-collapse: separate;
                    padding: 8px;
                    }

                    .panelTop{
      				margin-top: 2px;
    				margin-bottom: 2px;
    				}

    				.form-check-input {
    				width: 15px;
    				height: 15px;
    				}

        			.blockButton{
        			width: 60px;
        			height: 60px;
        			}

        			.borderless td, .borderless th {
            		border: none;
        			}
                </style>
                
                <!-- Spielmodus auswaehlen -->
                <div class="panel panel-default">
	      			<div class="panel-heading">
	        				<h4 class="panelTop">Spielmodus</h4>
	      			</div>
      				<div class="panel-body">
							<div class="btn-group btn-group-toggle" data-toggle="buttons">
							  <label class="btn btn-primary active">
							    <input onchange="changeSpielmodus('0')" type="radio" name="options" id="spielmodus1" autocomplete="off" checked> Spielmodus 1 (ohne Anfangsinventar)
							  </label>
							  <label class="btn btn-primary">
							    <input onchange="changeSpielmodus('1')" type="radio" name="options" id="spielmodus2" autocomplete="off"> Spielmodus 2 (mit Anfangsinventar)
							  </label>
							</div>
                    </div>
                   </div>
                
                <!--  Rundenanzahl auswaehlen -->
                <div class="panel panel-default">
      				<div class="panel-heading">
        				<h4 class="panelTop">Länge des Spiels</h4>
      				</div>
      				<div class="panel-body">     				
      					   <div class="btn-group btn-group-toggle" data-toggle="buttons">
							  <label class="btn btn-primary active">
							    <input onchange="changeRoundCount('2')" type="radio" name="options" id="roundCount1" autocomplete="off" checked> Demo (2 Runden)
							  </label>
							  <label class="btn btn-primary">
							    <input onchange="changeRoundCount('6')" type="radio" name="options" id="roundCount2" autocomplete="off"> Kurz (6 Runden)
							  </label>
							  <label class="btn btn-primary">
							    <input onchange="changeRoundCount('12')" type="radio" name="options" id="roundCount3" autocomplete="off"> Mittel (12 Runden)
							  </label>
							  <label class="btn btn-primary">
							    <input onchange="changeRoundCount('20')" type="radio" name="options" id="roundCount4" autocomplete="off"> Lang (20 Runden)
							  </label>
							</div>							                    		
                    </div>
                </div>

    <!--Spielerauswahl--> 
	<div class="panel-group" id="accordion">
		<div class="panel panel-default" id="contentStartseite">		
  		</div>  		
	</div>
	
	<script>
	
	function printStartseite(){
			var cont  = document.getElementById('contentStartseite');
			var s ="";
			
		for(var i =1; i <= 8; i++){
				
				s += 		'<!--Panel Spieler' + i + '-->' +
		  		'<div class="panel panel-default">' +
	    		'<div class="panel-heading">' +
	      			'<h4 class="panel-title">' +
	        			'<a data-toggle="collapse" data-parent="#accordion" href="#collapse' + i +'">' +
	        			'Spieler ' + i + 
	        			'</a>' +
	      			'</h4>' +
	    		'</div>' +
	    		'<div id="collapse'+i +'" class="panel-collapse collapse">'+
	    		'<div class="panel-body">' +
	  					
	    		'<table style="row">' +
	    		' <tr>' +
	    		' <td style="text-align: center; width: 5%">' +
	    		' <div class="form-check">' +
	    		'<input class="form-check-input" type="checkbox" value="" id="defaultCheck' + i + '" onclick="changePlayerCount(\x27defaultCheck'+i+'\x27)" >'+
	            '                    </div>' +
	              '              </td>' +
	              '<td>' +
	              '<input id="firma' + i + '" name="firmaSpieler' + i + '" placeholder="Firma" style="width: 200px">' +
	              '<p></p>' +
	              '</td>' +

	              '<td>' +
	              '<p>Bitte wählen Sie eine Region aus! Jede Region hat seine Vor- und Nachteile!' +
	              '<table class="borderless" style="width: 75%">' +
	              '<tr>' +
	              '<td style="text-align: right;">' +
	              '<button onclick="changeRegion(\x27regionSpieler' + i+ '\x27, \x27A\x27)" class="btn btn-primary blockButton" data-tooltip-id="tooltip1" data-toggle="tooltip" data-placement ="left" title="- Niedrige Mitarbeiterkosten<br/>- Höhere Angebotsattraktivität<br/> - Aber: Ineffiziente Marketingmaßnahmen " >A</button>' +
	              '</td>' +
	              ' <td style="text-align: left;">' +
	            
	              '<button onclick="changeRegion(\x27regionSpieler'+i +'\x27, \x27B\x27)" class="btn btn-primary blockButton" data-tooltip-id="tooltip2" data-toggle="tooltip" data-placement="right" title="- Niedrige Materialkosten <br/>- Effiziente Marketingmaßnahmen<br/> - Aber: Höhere Fertigungskosten " >B</button>'+
	              '</td>' +
	              '</tr>' +
	              '<tr>' +
	              '<td style="text-align: right;"> ' +
	              '<button onclick="changeRegion(\x27regionSpieler' + i+ '\x27, \x27C\x27)" class="btn btn-primary blockButton" data-tooltip-id="tooltip3" data-toggle="tooltip" data-placement="left" title="- Erfolgreichere Marketingmaßnahmen <br/>- Höhere Angebotsattraktivität <br/>- Aber: Höhere Fertigungs- und Mitarbeiterkosten<br/> " >C</button>' + 
	              '</td>' +
	              '<td style="text-align: left;">' +
	              '<button onclick="changeRegion(\x27regionSpieler' + i+ '\x27, \x27D\x27)" class="btn btn-primary blockButton" data-tooltip-id="tooltip4" data-toggle="tooltip" data-placement="right" title="- Niedrige Mitarbeiterkosten <br/>- Niedrige Fertigungskosten <br/> - Aber: Höhere Materialkosten" >D</button>' +
	              '</td>' +
	              '</tr>' +
	              '</table>' +
	              '<p id="regionSpieler' + i +'">Gewählte Region:</p>' +
	              '</td>' +
	              '<td>' +
	              '<button type="button" id="unternehmen' + i + '" onclick="unternehmenHinzufuegen(this)" class="btn btn-primary">Unternehmen hinzufügen</button>' +
	              '<p></p>'+
	              '<p id="fehlermeldung' + i +'"></p>' +
	              '</td>' +
	              '</tr>' +
	              '</table>' +
	              '</div>' +
	              '</div>' +
	              '</div>' 
		}
		cont.innerHTML = s;
		
		}
	</script>

				<hr>
                <h3>Übersicht</h3>

				<style>
					.gameSummary {
						color: green;
						font-size: 15px;
					}
				</style>

				<div class="well well-sm">
					<p class="gameSummary">Spielmodus:
						<p style="font-weight: bold" id="spielmodusText">Spielmodus 1 (ohne Anfangsinventar)</p> <!--damit zwangsweise etwas ausgewählt ist-->
					</p>
					

					<p class="gameSummary">Anzahl der Runden:
						<p style="font-weight: bold" id="anzahlRundenText">2 Runden</p> <!--damit zwangsweise etwas ausgewählt ist-->
					</p>
					
					<p class="gameSummary">Anzahl der Spieler: 				
						<p style="font-weight: bold" id="anzahlSpielerText">2 Spieler</p> <!--damit zwangsweise etwas ausgewählt ist-->
					</p>					
				</div>

                <p></p>
                <hr>
               
				<p></p>
						
            	<button type="button" id="button" onclick="spielStarten()" class="btn btn-primary float-right" >Spiel starten</button>	<!--HIER NOCH DATEN ÜBERMITTELN-->
				<p></p>
                <p id="fehlermeldungSpielStarten"></p>
                            	
        </div>	

    <!-- Modal, nachdem auf Button "Spiel starten" geklickt wurde -->
        <div class="modal fade" id="modalContent" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">Hinweis</h4>
              </div>
              <div class="modal-body">
                <h2>Die Unternehmenssimulation startet in 30 Sekunden!</h2>
                    <br>
                    <p>Du kannst im Navigationsbereich die Elemente Beschaffung, Verarbeitung und Verkauf auswählen und entsprechend Produkte produzieren.</p>
                    <p>Nach jeder Runde erhälst du eine Übersicht und kannst deine Ergebnisse mit denen der anderen Spieler vergleichen.</p>
					<br>
                    <p>Viel Erfolg!</p>
              </div>
            </div>
          </div>
        </div>
	
		    
    <!-- Fixed footer -->
    <div class="navbar navbar-inverse navbar-fixed-bottom" role="navigation">
        <div class="container">
            <div class="navbar-text pull-left">
                <p>© 2018 </p>
            </div>
            <div class="navbar-text pull-right">
                <!-- <a href="#help">Hilfe</a> -->       
            </div>
        </div>
    </div>
    
    <script>
	    $(document).ready(function() {
	    	printStartseite();	    	

	    	// Tooltip
	     	$('[data-toggle="tooltip"]').tooltip({
	    		track: true,
	    	    container: 'body',
	    	    html: true,
	    	}); 

	    	
	    	jQuery.ajax({
        		
		 		url: "../api/spiel/neuesspiel",
		 		type: "GET",
		 		sucess: function() {
		 			confirm("Neues Spiel eröffnet");
		 			location.reload(true);
		 		},
			    error: function() {
			        console.log("Fehler");
			    }
	 		});
	    });
    

        var spielmodus = 0;
        var rundenAnzahl = 2;
        var anzahlSpieler = 0;
    	var standort = "";
    	
    	document.getElementById('anzahlSpielerText').innerHTML = anzahlSpieler + " Spieler";
        
        var erstesUnternehmenHinzugefuegt = false;
        var zweitesUnternehmenHinzugefuegt = false;
        
        function spielStarten() {       	
        	// Wenn zwei Unternehmen hinzugefuegt wurden, dann kann das Spiel gestartet werden und die Schnittstelle wird aufgerufen
        	if (erstesUnternehmenHinzugefuegt == true && zweitesUnternehmenHinzugefuegt == true) {           	
            	jQuery.ajax({          				
    		 		url: "../api/spiel/starten?rundenZahl=" + rundenAnzahl + "&szenario=" + spielmodus,
    		 		type: "GET",
    		 		sucess: function() {
    		 			confirm("Unternehmen hinzugefuegt");
    		 			location.reload(true);
    		 			 console.log("Erfolg");
    		 		},
    			    error: function() {
    			        console.log("Fehler");
    			    }
    	 		});
            	
            	// Modal anzeigen
            	$('#modalContent').modal({
            		  keyboard: true, //ESC-Taste schließt Modal
            		  backdrop: true, //beim Klick außerhalb des Modals, wird dieses geschlossen (sonst "static")
            		  show: true, //Modal wird nach dem Initialisieren angezeigt
            		});
            	
            	loadNextPage();
            	
        	} else { // Fehlermeldung, falls nicht min. zwei Spieler hinzugefuegt wurden
        		document.getElementById('fehlermeldungSpielStarten').innerHTML = "Es müssen mindestens zwei Unternehmen hinzugefügt werden, um das Spiel zu starten.";
        		setColourRed(document.getElementById('fehlermeldungSpielStarten'));
        	}
        }
        
        // Funktion, um nächste Seite zu laden
        function loadNextPage(){
            window.setTimeout(function(){
            window.location.href = "einkauf.html";
            }, 1000); //Test: 1sec 
        }        

     	// Funktion, um Spielmodus zu verändern
        function changeSpielmodus(count){
        	spielmodus = count;
        	
        	if (spielmodus==0 ){
        		document.getElementById('spielmodusText').innerHTML= "Spielmodus 1 (ohne Anfangsinventar)";
        	} else {
        		document.getElementById('spielmodusText').innerHTML= "Spielmodus 2 (mit Anfangsinventar)";
        	}
        	
        	spielmodus = count;
        }
     	
		// Funktion, um Spieleranzahl zu verändern
        function changePlayerCount(checkBoxID) {
            var checkBoxObject = document.getElementById(checkBoxID);
            if (checkBoxObject.checked == true) {
                anzahlSpieler = anzahlSpieler + 1;
            } else {
                anzahlSpieler = anzahlSpieler - 1;
            }
            document.getElementById('anzahlSpielerText').innerHTML = anzahlSpieler + " Spieler";
        }

     	// Funktion, um Rundenanzahl zu verändern
        function changeRoundCount(count){
        	document.getElementById('anzahlRundenText').innerHTML= count + " Runden";
        	rundenAnzahl=count;
        }

     	// Funktion, um Standort zu setzen und zu verändern
        function changeRegion(player, region){
        	document.getElementById(player).innerHTML = "Gewählte Region: <b>" + region + "</b>";
        	standort = region;
        }
        
        // Beim Klick auf Unternehmen hinzufuegen
        function unternehmenHinzufuegen(ele){
        	var firma;
    		
    		for (var i=1;i<=8; i++){
    			if (ele.id == "unternehmen"+i){ // Richtige ID ansprechen
         			firma = document.getElementById("firma"+i).value;
         			if (firma == "" && standort ==""){ // Falls keine Firma und Standort ausgewaehlt
         				document.getElementById("fehlermeldung"+i).innerHTML = "Bitte Firma und Region auswählen!";
         				setColourRed(document.getElementById("fehlermeldung" +i));
         			} else if (standort ==""){ // Falls kein Standort ausgewaehlt
         				document.getElementById("fehlermeldung" +i).innerHTML = "Bitte Region auswählen!";
         				setColourRed(document.getElementById("fehlermeldung" +i));
         			} else if (firma == "") { // Falls keine Firma ausgewaehlt
         				document.getElementById("fehlermeldung" +i).innerHTML = "Bitte Firma auswählen!";
         				setColourRed(document.getElementById("fehlermeldung" +i));
         			} else {
         				callUnternehmenHinzufuegen(firma,standort);
         				document.getElementById("fehlermeldung"+i).innerHTML = "Unternehmen wurde hinzugefügt!";
         				setColourBlack(document.getElementById("fehlermeldung" +i));
         				
         				if (erstesUnternehmenHinzugefuegt == true) {
         					zweitesUnternehmenHinzugefuegt = true;
         				}
         				erstesUnternehmenHinzugefuegt = true;
         				
         				standort = "";
         			}
    			} 			
    		}
        }
    		    
        function setColourRed(element){
        	element.style.color = "#FF0000";
        }
        function setColourBlack(element){
        	element.style.color = "#000000";
        }
        
        function callUnternehmenHinzufuegen(firma, standort) {
        	jQuery.ajax({
		 		url: "../api/spiel/neuesunternehmen?name=" + firma + "&standort=" + standort,
		 		type: "GET",
		 		sucess: function() {
		 			confirm("Unternehmen hinzugefuegt");
		 			location.reload(true);
		 		},
			    error: function() {
			        console.log("Fehler");
			    }
	 		});   	
        }
    </script>
  </body>
</html>