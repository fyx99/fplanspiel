<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rohstoffe</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

 </head>
 
 <body onload="start()">
    <script type="text/javascript" >
      $(document).ready(function() {
                $('#navbar').load('navbar.html');
                $('#footer').load('footer.html');
                });

    </script>

    <script>
    function getData(){
      jQuery.ajax({
        url: "../api/spiel/unternehmen",
        type: "GET",
        dataType: "json",
        success: function(data, data2){
          printData(data.bmarkt.angebote);
        }
      });
    }
    function printData(data){
      var cont  = document.getElementById('rohstoffContent');
      var s ="";
      var bilder = ["img/holz.jpg", "img/stoff.jpg", "img/leder.jpg", "img/plastik.jpg", "img/edelstahl.jpg", "img/glas.jpg"];
      var index = 0;

      for(var angebot in data){
        s += '<div class="col-sm-6 col-md-4">' + 
            '<div class="thumbnail">' + 
            '<img src="' + bilder[index] +'" alt="' + data[angebot].markteinheit.name + '">' + 
            '<div class="caption">' + 
            '<h3>' + data[angebot].markteinheit.name + '</h3>' + 
            '<p>Verfügbare Menge:</p>' + 
            '<div class="progress">' + 
            '<div class="progress-bar" id="progressbar' + data[angebot].markteinheit.name + '" role="progressbar" data-toggle="tooltip" title="' + data[angebot].menge + '/100" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:' + data[angebot].menge + '%;">25%</div>' + 
            '</div>' + 
            '<p><Button onclick="loadData()" data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</Button> <Button data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</Button></p>' + 
            '</div></div></div>';

            index++;
      }
      cont.innerHTML = s;
    }
    </script>
  <Button onclick="getData()">Test</Button>
 
    <!-- Fixed navbar -->
    <div id="navbar">
  </div>
    
	<!-- Page Header -->
	<div class="container">	
        <div class="page-header">
            <h1>Rohstoffe</h1>
        </div>
        <!--ROHSTOFFE ÜBERSICHT-->
        	<div class="well">
        		<div class="row" id="rohstoffContent">
  					<!--<div class="col-sm-6 col-md-4">
    					<div class="thumbnail">
      						<img src="img/holz.jpg" alt="Holz">
     						<div class="caption">
       							<h3>Holz</h3>
        						<p>Verfügbare Menge:</p>
        						<div class="progress">
  									<div class="progress-bar" id="progressbarHolz" role="progressbar" data-toggle="tooltip" title="100/100" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
   									100%
  									</div>
								</div>
        						<p><a data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</a></p>
      						</div>
    					</div>
  					</div>

  					<div class="col-sm-6 col-md-4">
    					<div class="thumbnail">
      						<img src="img/stoff.jpg" alt="Stoff">
     						<div class="caption">
       							<h3>Stoff</h3>
        						<p>Verfügbare Menge:</p>
        						<div class="progress">
  									<div class="progress-bar" role="progressbar" data-toggle="tooltip" title="95/100" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100" style="width: 95%;">
   									95%
  									</div>
								</div>
        						<p><a data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</a></p>
      						</div>
    					</div>
  					</div>

  					<div class="col-sm-6 col-md-4">
    					<div class="thumbnail">
      						<img src="img/leder.jpg" alt="Leder">
     						<div class="caption">
       							<h3>Leder</h3>
        						<p>Verfügbare Menge:</p>
        						<div class="progress">
  									<div class="progress-bar" role="progressbar" data-toggle="tooltip" title="25/100" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
   									25%
  									</div>
								</div>
        						<p><a data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</a></p>
      						</div>
    					</div>
  					</div>

  					<div class="col-sm-6 col-md-4">
    					<div class="thumbnail">
      						<img src="img/plastik.jpg" alt="Kunststoff">
     						<div class="caption">
       							<h3>Kunststoff</h3>
        						<p>Verfügbare Menge:</p>
        						<div class="progress">
  									<div class="progress-bar" role="progressbar" data-toggle="tooltip" title="10/100" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width: 10%;">
   									10%
  									</div>
								</div>
        						<p><a data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</a></p>
      						</div>
    					</div>
  					</div>

  					<div class="col-sm-6 col-md-4">
    					<div class="thumbnail">
      						<img src="img/edelstahl.jpg" alt="Edelstahl">
     						<div class="caption">
       							<h3>Edelstahl</h3>
        						<p>Verfügbare Menge:</p>
        						<div class="progress">
  									<div class="progress-bar" role="progressbar" data-toggle="tooltip" title="80/100" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;">
   									80%
  									</div>
								</div>
        						<p><a data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</a></p>
      						</div>
    					</div>
  					</div>

  					<div class="col-sm-6 col-md-4">
    					<div class="thumbnail">
      						<img src="img/glas.jpg" alt="Glas">
     						<div class="caption">
       							<h3>Glas</h3>
        						<p>Verfügbare Menge:</p>
        						<div class="progress">
  									<div class="progress-bar" role="progressbar" data-toggle="tooltip" title="50/100" aria-valuenow="75" aria-valuemin="0" aria-valuemax="10" style="width: 50%;">
   									50%
  									</div>
								</div>
        						<p><a data-toggle="modal" data-target="#verkaufen" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" data-target="#details" class="btn btn-primary" role="button">Details</a></p>
      						</div>
    					</div>
  					</div>
  				</div>-->
  			</div>
        </div>
    </div>
	
   
    <!-- Fixed footer -->
    <div id="footer">
    </div>

    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

<!--Modal-Details-->
  <div class="modal fade" id="details" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h2 class="modal-title" id="verkaufenDialogTitel">Details</h2>
         </div>
         <div class="modal-body">

            <h4>Holz wird zur Produktion folgender Möbelstücke benötigt:</h4>
            	<li>Holzstuhl</li>
            	<li>Stoffstuhl</li>
            	<li>Lederstuhl</li>
            	<li>Holztisch</li>
            	<li>Holzschrank</li>
            	<li>Edelstahlschrank</li>
            	<li>Glasschrank</li>
            <hr>
            <h4>Verfügbare Menge an Holz:</h4>
            <p>Im Lager: 40 ME</p>
            <p>Größe des Lagers: 100 ME</p>

            <div class="progress">
              <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"  style="width: 40%">40%
                <span class="sr-only">40% abgeschlossen (Erfolg)</span>
              </div>
            </div>

         </div>
         <div class="modal-footer">
            <p>
              <button class="btn btn-primary" data-dismiss="modal" role="button">Schließen</button>
            </p>  
         </div>
       </div>
    </div>
  </div>

 <!--Modal-Verkaufen-->
  <div class="modal fade" id="verkaufen" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h2 class="modal-title" id="verkaufenDialogTitel">Rohstoffe verkaufen</h2>
         </div>
         <div class="modal-body">

            <h4>Bitte wählen Sie die zu verkaufende Menge des Rohstoffs: </h4>
            
            <style>
				.erlös {
				color: green;
				}
            </style>
            <div>         
  				<table class="table">
    				<tbody>
      					<tr>
        					<td>Menge im Lager:</td>
        					<td id="mengeImLagerID"></td>
      					</tr>
      					<tr>
        					<td>Preis pro ME:</td>
        					<td id="preisProMengeID"></td>
      					</tr>
      					<tr>
        					<td>Menge zu verkaufen:</td>
        					<td>            
        						<div class="input-group">
            						<input class="form-control input-sm" id="zuVerkaufendeMengeID">
            						<span class="input-group-addon">ME</span>
            					</div>
            				</td>
      					</tr>
    				</tbody>
  				</table>
			</div>

			<div class="well well-sm" style="font-weight: bold;">
				<p id="erlösAusVerkaufVon">Erlös aus dem Verkauf von </p>
					<p class="erlös" id="erlösAnzeigeID"></p>
			</div>

			<div>
				<button class="btn btn-primary" id="buttonBerechnen" onclick="berechneErlös()">Erlös berechnen</button>
				<label for="buttonBerechnen" id="bemerkungBerechnen" style="color: red"></label>
			<div>

         </div>
         <div class="modal-footer">
            <p>
              <button class="btn btn-primary" data-dismiss="modal">Schließen</button>
              <button class="btn btn-danger" onclick="rohstoffeVerkaufen()" id="verkaufenButtonID">Verkaufen</button>
            </p>  
         </div>
       </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <script>
  	var mengeImLager = 0;
  	var preisProMenge = 0;
  	var zuVerkaufendeMenge = 0;
  	var erlös = 0;

    function loadData(){
      jQuery.ajax({
        url: "../webapi/v1/demo/unternehmen",
        type: "GET",
        dataType: "json",
        success: function(data, data2){
          setValues(data.bmarkt.angebote);
        }
      });
    }

    function setValues(data){
    	console.log(data[0].menge);
    	console.log(data[0].preis);
    	console.log("stop");
    	console.log(data[1].menge);
    	console.log(data[1].preis); //hier irgendwie Daten richtig zuordnen, aber funktioniert so erstmal
    	console.log("stop1");
    	for ( var test in data) {
    	      mengeImLager = data[test].menge;
    	      console.log(data[test].menge);
    	      preisProMenge = data[test].preis;
    	      console.log(data[test].preis);
    	  	  document.getElementById('mengeImLagerID').innerHTML = mengeImLager + " ME";
    	  	  document.getElementById('preisProMengeID').innerHTML = preisProMenge + " GE";
    	      break;
		}

    }

  	window.onload = function(){
  		document.getElementById('mengeImLagerID').innerHTML = mengeImLager + " ME";
  		document.getElementById('preisProMengeID').innerHTML = preisProMenge + " GE";
  	}

  	function berechneErlös(){
  		zuVerkaufendeMenge = document.getElementById('zuVerkaufendeMengeID').value;
  		document.getElementById('erlösAusVerkaufVon').innerHTML = "Erlös aus dem Verkauf von " + zuVerkaufendeMenge + " ME:"
  		erlös = zuVerkaufendeMenge * preisProMenge;
  		document.getElementById('erlösAnzeigeID').innerHTML = erlös + " GE";
  	}

  	function rohstoffeVerkaufen(){
  		berechneErlös();
  		if (zuVerkaufendeMenge >= 0 && mengeImLager > 0) {
  			mengeImLager = mengeImLager - zuVerkaufendeMenge;

  			var progressbar = document.getElementById('progressbarHolz');

  			$(progressbar).tooltip('hide')
          		.attr('data-original-title', mengeImLager + "/100")
         		.tooltip('fixTitle')
          		.tooltip('show');

  			progressbar.style = "width: " + (mengeImLager/100)*100 + "%;";



  			document.getElementById('mengeImLagerID').innerHTML = mengeImLager + " ME";
  		} else {
  			document.getElementById('bemerkungBerechnen').innerHTML = "Bitte geben Sie eine Zahl größer oder gleich 0 ein!";
  		}
  	}

	$('#verkaufen').on('hidden.bs.modal', function (e) {
  		$(this)
    		.find("input,textarea,select")
       		.val('')
       		.end()
       	$(this)
       		.find("#erlösAusVerkaufVon")
       		.html("Erlös aus dem Verkauf von ")
       		.end()
       	$(this)
       		.find("#erlösAnzeigeID")
       		.html("")
       		.end()
	});
  </script>
    

    <script>
		$(document).ready(function(){
    	$('[data-toggle="tooltip"]').tooltip();
    	});
    </script>
  </body>
</html>