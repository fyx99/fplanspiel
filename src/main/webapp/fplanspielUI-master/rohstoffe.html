<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rohstoffe</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

 </head>
 
 <body onload="start()">
    <script type="text/javascript" >
      $(document).ready(function() {
                $('#navbar').load('navbar.html');
                getData();
                $('#footer').load('footer.html');
                });

    </script>

    <script>
    function getData(){
      jQuery.ajax({
        url: "../api/spiel/unternehmen",
        type: "GET",
        dataType: "json",
        success: function(data, data2){
          printData(data.materialien);
        }
      });
    }
    function printData(data){
      var index = 0;
      var maxLagerKapazität = 100000;
      console.log(data.Glas);
      var name = "";
      var menge = "";
      var bild = "";

    	  if(data.Holz > 0){
    		  name = "Holz";
    		  menge = data.Holz;
    		  bild = "img/holz.jpg";
    		  printCard(name, menge, bild);
    	  } 
    	  
    	  if(data.Stoff > 0){
    		  name = "Stoff";
    		  menge = data.Stoff;
    		  bild = "img/stoff.jpg";
    		  printCard(name, menge, bild);
    	  }
    	  
    	  if(data.Leder > 0){
    		  name = "Leder";
    		  menge = data.Leder;
    		  bild = "img/leder.jpg";
    		  printCard(name, menge, bild);
    	  }
    	  
    	  if(data.Kunststoff > 0){
    		  name = "Kunststoff";
    		  menge = data.Kunststoff;
    		  bild = "img/plastik.jpg";
    		  printCard(name, menge, bild);
    	  }
    	  
    	  if(data.Edelstahl > 0){
    		  name = "Edelstahl";
    		  menge = data.Edelstahl;
    		  bild = "img/edelstahl.jpg";
    		  printCard(name, menge, bild);
    	  }
    	  
    	  if(data.Glas > 0){
    		  name = "Glas";
    		  menge = data.Glas;
    		  bild = "img/glas.jpg";
    		  printCard(name, menge, bild);
    	  }
      
            //Math.round((data[angebot].menge * 100)/maxLagerKapazität) für Prozentzahl in Progressbar
    }
    function printCard(name, menge, bild){
    	var s ="";
    	var maxLagerKapazität = 100000;
    	
    	s += '<div class="col-sm-6 col-md-4">' + 
        '<div class="thumbnail">' + 
        '<img src="' + bild + '" alt="' + name + '">' + 
        '<div class="caption">' + 
        '<h3>' + name + '</h3>' + 
        '<p>Verfügbare Menge:</p>' + 
        '<div class="progress">' + 
        '<div class="progress-bar" role="progressbar" data-toggle="tooltip" title="' + menge + '/' + maxLagerKapazität + '" aria-valuenow="' + menge + '" aria-valuemin="0" aria-valuemax="' + maxLagerKapazität + '" style="width:' + (menge * 100)/maxLagerKapazität + '%;">' + Math.round((menge * 100)/maxLagerKapazität) + '%</div>' + 
        '</div>' + 
        '<p><a href="verkauf.html" class="btn btn-danger" role="button">Verkaufen</a> <a data-toggle="modal" onclick="loadDataDetails( + index + )" data-target="#details" class="btn btn-primary" role="button">Details</a></p>' + 
        '</div></div></div>';
        
        document.getElementById('rohstoffContent').innerHTML += s;
    }
    </script>
 
    <!-- Fixed navbar -->
    <div id="navbar">
  </div>
    
	<!-- Page Header -->
	<div class="container">	
        <div class="page-header">
            <h1>Rohstoffe</h1>
        </div>
        <!--ROHSTOFFE ÜBERSICHT-->
        	<div class="well">
        		<div class="row" id="rohstoffContent">
  					
  				</div>
        	</div>
    </div>
	
   
    <!-- Fixed footer -->
    <div id="footer">
    </div>

    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

<!--Modal-Details-->
  <div class="modal fade" id="details" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h2 class="modal-title" id="detailsDialogTitel">Details</h2>
         </div>
         <div class="modal-body" id="detailsModalContent">

            <h4>Holz wird zur Produktion folgender Möbelstücke benötigt:</h4>
            	<li>Holzstuhl</li>
            	<li>Stoffstuhl</li>
            	<li>Lederstuhl</li>
            	<li>Holztisch</li>
            	<li>Holzschrank</li>
            	<li>Edelstahlschrank</li>
            	<li>Glasschrank</li>
            <hr>
            <h4>Verfügbare Menge an Holz:</h4>
            <p>Im Lager: 40 ME</p>
            <p>Größe des Lagers: 100 ME</p>

            <div class="progress">
              <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"  style="width: 40%">40%
                <span class="sr-only">40% abgeschlossen (Erfolg)</span>
              </div>
            </div>

         </div>
         <div class="modal-footer">
            <p>
              <button class="btn btn-primary" data-dismiss="modal" role="button">Schließen</button>
            </p>  
         </div>
       </div>
    </div>
  </div>

 <!--Modal-Verkaufen-->
  <div class="modal fade" id="verkaufen" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h2 class="modal-title" id="verkaufenDialogTitel">Rohstoffe verkaufen</h2>
         </div>
         <div class="modal-body">

            <h4>Bitte wählen Sie die zu verkaufende Menge des Rohstoffs: </h4>
            
            <style>
				.erlös {
				color: green;
				}
            </style>
            <div>         
  				<table class="table">
    				<tbody>
      					<tr>
        					<td>Menge im Lager:</td>
        					<td id="mengeImLagerID"></td>
      					</tr>
      					<tr>
        					<td>Preis pro ME:</td>
        					<td id="preisProMengeID"></td>
      					</tr>
      					<tr>
        					<td>Menge zu verkaufen:</td>
        					<td>            
        						<div class="input-group">
            						<input class="form-control input-sm" id="zuVerkaufendeMengeID">
            						<span class="input-group-addon">ME</span>
            					</div>
            				</td>
      					</tr>
    				</tbody>
  				</table>
			</div>

			<div class="well well-sm" style="font-weight: bold;">
				<p id="erlösAusVerkaufVon">Erlös aus dem Verkauf von </p>
					<p class="erlös" id="erlösAnzeigeID"></p>
			</div>

			<div>
				<button class="btn btn-primary" id="buttonBerechnen" onclick="berechneErlös()">Erlös berechnen</button>
				<label for="buttonBerechnen" id="bemerkungBerechnen" style="color: red"></label>
			<div>

         </div>
         <div class="modal-footer">
            <p>
              <button class="btn btn-primary" data-dismiss="modal">Schließen</button>
              <button class="btn btn-danger" onclick="rohstoffeVerkaufen()" id="verkaufenButtonID">Verkaufen</button>
            </p>  
         </div>
       </div>
    </div>
  </div>
  </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <script>
  	var mengeImLager = 0;
  	var preisProMenge = 0;
  	var zuVerkaufendeMenge = 0;
  	var erlös = 0;
  	var progressBarVariable = null;

    function loadData(index){
      jQuery.ajax({
        url: "../api/spiel/unternehmen",
        type: "GET",
        dataType: "json",
        success: function(data, data2){
          setValues(data.bmarkt.angebote, index);
        }
      });
    }

    function setValues(data, index){
    	mengeImLager = data[index].menge;
    	preisProMenge = data[index].preis;
    	document.getElementById('mengeImLagerID').innerHTML = mengeImLager + " ME";
    	document.getElementById('preisProMengeID').innerHTML = preisProMenge + " GE";
    	progressBarVariable = "progressbar" + index;
    }
    
    function loadDataDetails(index){
        jQuery.ajax({
          url: "../api/spiel/unternehmen",
          type: "GET",
          dataType: "json",
          success: function(data, data2){
            setValuesDetails(data.bmarkt.angebote, index);
          }
        });
      }

      function setValuesDetails(data, index){
    	document.getElementById('detailsDialogTitel').innerHTML = "Details zu: " + data[index].markteinheit.name;
    	content = '<table class="table">' + 
		'<tr><td><b>Verfügbare Menge an ' + data[index].markteinheit.name + ': </b></td><td>' + data[index].menge + ' ME</td</tr>' + 
		'</table>';
      	document.getElementById('detailsModalContent').innerHTML = content;

      }

  	window.onload = function(){
  		document.getElementById('mengeImLagerID').innerHTML = mengeImLager + " ME";
  		document.getElementById('preisProMengeID').innerHTML = preisProMenge + " GE";
  	}

  	function berechneErlös(){
  		zuVerkaufendeMenge = document.getElementById('zuVerkaufendeMengeID').value;
  		document.getElementById('erlösAusVerkaufVon').innerHTML = "Erlös aus dem Verkauf von " + zuVerkaufendeMenge + " ME:"
  		erlös = zuVerkaufendeMenge * preisProMenge;
  		document.getElementById('erlösAnzeigeID').innerHTML = erlös + " GE";
  	}

  	function rohstoffeVerkaufen(){
  		if (zuVerkaufendeMenge >= 0 && mengeImLager > 0 && (mengeImLager-zuVerkaufendeMenge) >= 0) {//TODO BUG
  			berechneErlös();
  			mengeImLager = mengeImLager - zuVerkaufendeMenge;

  			var progressbar = document.getElementById(progressBarVariable);

  			$(progressbar).tooltip('hide')
          		.attr('data-original-title', mengeImLager + "/100000")//Hardcode
         		.tooltip('fixTitle')
          		.tooltip('show');

  			progressbar.style = "width: " + (mengeImLager/100000)*100 + "%;";//Hardcode



  			document.getElementById('mengeImLagerID').innerHTML = mengeImLager + " ME";
  		} else if (mengeImLager == 0){
  			document.getElementById('bemerkungBerechnen').innerHTML = "Ihr Lager dieses Rohstoffs ist leer!";
  		} else { 
  			document.getElementById('bemerkungBerechnen').innerHTML = "Bitte geben Sie eine Zahl größer oder gleich 0 ein!";
  		}
  	}

	$('#verkaufen').on('hidden.bs.modal', function (e) {
  		$(this)
    		.find("input,textarea,select")
       		.val('')
       		.end()
       	$(this)
       		.find("#erlösAusVerkaufVon")
       		.html("Erlös aus dem Verkauf von ")
       		.end()
       	$(this)
       		.find("#erlösAnzeigeID")
       		.html("")
       		.end()
       	$(this)
       		.find("#bemerkungBerechnen")
       		.html("")
       		.end()
	});
  </script>
    

    <script>
		$(document).ready(function(){
    	$('[data-toggle="tooltip"]').tooltip();
    	});
    </script>
  </body>
</html>