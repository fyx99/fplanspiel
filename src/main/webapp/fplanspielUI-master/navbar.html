<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bootstrap 3 Tutorial from BootstrapBay.com">
    <meta name="author" content="BootstrapBay.com">
    <title>BootstrapBay Tutorial</title>

 </head>

 <body onload="start()">

<script type="text/javascript">

	$(document).ready(function() {
 			getKapital();
 			getSpielername();
 			getRunde();
 		});
	
	var rundenAnzahl;
		function getKapital(){
			jQuery.ajax({
				url: "../api/spiel/unternehmen",
				type: "GET",
				dataType: "json",
				success: function(data, data2){
					var cont  = document.getElementById('kapitalContent');
					var s =data.kapital;
					cont.innerHTML += s + " €";
					console.log(data.kapital);
					//console.log(data.bmarkt.angebote);
					//console.log(data.mmarkt.angebote);

						/*for(var angebot in data){
				s += '<div class="col-sm-6 col-md-4"><div class="thumbnail"><img src="img/leder.jpg" alt="Leder"><div class="caption"><h3>' + data[angebot].markteinheit.name   +
						'</h3><p>Kommentar ?</p>' + 
						'<div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">25%</div>' + 
						'</div><p><a href="#" class="btn btn-danger" role="button">Verkaufen</a> <a href="#" class="btn btn-primary" role="button">Informationen</a></p>' + 
						'</div></div></div>';
			}*/
					
				}
			});
		}

		function getSpielername(){
			jQuery.ajax({
				url: "../api/spiel/unternehmen",
				type: "GET",
				dataType: "json",
				success: function(data, data2){
					var cont  = document.getElementById('spielerName');
					var s =data.name;
					cont.innerHTML += s;
					//console.log(data.kapital);
					//console.log(data.bmarkt.angebote);
					//console.log(data.mmarkt.angebote);
					
				}
			});
		}

		function getRunde(){
			jQuery.ajax({
				url: "../api/spiel/zwischenstand",
				type: "GET",
				dataType: "json",
				success: function(data, data2){
					var cont  = document.getElementById('runde');
					var s =data.runde;
					cont.innerHTML += s;
					console.log(data.runde);
					//console.log(data.bmarkt.angebote);
					//console.log(data.mmarkt.angebote);
					
					rundenAnzahl = s;
					
					if (rundenAnzahl > 1) {
						document.getElementById('ergebnisLetzteRunde').innerHTML = "Ergebnis der letzten Runde";
						//Ergebnis der letzten Runde
					} else {
						return;
					}
					
					
				}
			});
		}

		function beendeZug(){
			jQuery.ajax({
				url: "../api/spiel/zugbeendet",
				type: "GET",
				dataType: "json",
				success: function(data, data2){
					var runde = data;
					console.log(data);
					if (runde>0) {
						window.location.href = "ergebnis_runde.html";
					} else if (runde==0) {
						$(document).ready(function(){
  								$('#modalContentZugBeenden').modal('show');
								});

						window.setTimeout(function(){
			            window.location.href = "einkauf.html";
			            }, 1000); //Test: 1sec 
					} else {
						window.location.href = "ergebnis_ende.html";
					}
				}

			});
			}

			function ladeErgebnisLetzteRunde(){
			jQuery.ajax({
				url: "../api/spiel/rundenresultat",
				type: "GET",
				dataType: "json",
				success: function(data, data2){
					//var einnahmen  = document.getElementById('einnahmen');
					//var ausgaben  = document.getElementById('ausgaben');
					var kapital  = document.getElementById('kapital');
					//var marketing = document.getElementById('marketingMaßnahmen');
					var mitarbeiter = document.getElementById('mitarbeiterAnzahl');
					
					var einnahmenData =data.guv.einnahmen;				
					var ausgabenData =data.guv.ausgaben;
					var kapitalData =data.kapital;
					var marketingData = data.marketingMaßnahmen;
					var mitarbeiterData = data.mitarbeiterAnzahl;
					
					//einnahmen.innerHTML = einnahmenData;
					//ausgaben.innerHTML =ausgabenData;
					kapital.innerHTML = kapitalData + " €";
					mitarbeiter.innerHTML = mitarbeiterData;
					//marketing = marketingData;
					
					ladeEinnahmenData(einnahmenData);
					ladeAusgabenData(ausgabenData);
					ladeMarketingData(marketingData);
					
					//console.log(data.kapital);
					//console.log(data.bmarkt.angebote);
					//console.log(data.mmarkt.angebote);
					
				}
			});
		}
			
			function ladeMarketingData(marketingData){
				
				var marketing = document.getElementById('marketingMaßnahmen');
				var summeMarketing = 0;
				
				for(var index in marketingData){
					
					summeMarketing += marketingData[index].budget;
				}
				
				marketing.innerHTML =summeMarketing + " €";
				
				// marketing = marketingData;
			}
			
			
			function ladeEinnahmenData(einnahmenData){
				
				var einnahmen  = document.getElementById('einnahmen');
				var summeEinnahmen = 0;
				
				for(var index in einnahmenData){
					
					summeEinnahmen += einnahmenData[index].summe;
				}
				
				einnahmen.innerHTML =summeEinnahmen + " €";
			}
			
			
			function ladeAusgabenData(ausgabenData){
				
				var ausgaben  = document.getElementById('ausgaben');
				var summeAusgaben = 0;
				
				for(var index in ausgabenData){
					
					summeAusgaben += ausgabenData[index].summe;
				}
				
				ausgaben.innerHTML =summeAusgaben + " €";
			}

		

</script>
     <div class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand">Unternehmensplanspiel</a>
			</div>
			<div class="navbar-collapse collapse">
		
				<ul class="nav navbar-nav navbar-default">
					<!-- Beschaffung -->					
					<li class="dropdown">
						<a href="einkauf.html" class="dropdown-toggle" data-toggle="dropdown">Beschaffung <b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="einkauf.html">Beschaffung</a></li>
							<li class="divider"></li>
							<li><a href="einkauf.html#materialien">Materialien</a></li>
							<li><a href="einkauf.html#maschinen">Maschinen</a></li>
							<li><a href="einkauf.html#kredite">Kredite</a></li>
							<li><a href="einkauf.html#mitarbeiter">Mitarbeiter</a></li>        
						</ul>
					</li>

					<!-- Fertigung -->
					<li class="dropdown">
						<a href="verarbeitung.html" class="dropdown-toggle" data-toggle="dropdown">Fertigung <b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li class="dropdown-header">Fertigung</li>
							<li class="divider"></li>
							<li><a href="verarbeitung.html">Produktauswahl</a></li>
						</ul>
					</li>      

					<!-- Verkauf -->
					<li class="dropdown">
						<a href="verkauf.html" class="dropdown-toggle" data-toggle="dropdown">Verkauf <b class="caret"></b></a>
						<ul class="dropdown-menu">
						
							<li><a href="verkauf.html">Verkauf</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Angebote</li>
							<li><a href="verkauf.html#angebotNeu"">Neues Angebot</a></li>
							<li><a href="verkauf.html#angebote">Bestehende Angebote</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Maschinen</li>
							<li><a href="verkauf.html#maschinen">Maschinen verkaufen</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Mitarbeiter</li>
							<li><a href="verkauf.html#mitarbeiter">Mitarbeiter kündigen</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Marketing</li>
							<li><a href="marketing-angebote.html">Marketing</a></li>
						</ul>
					</li>

					<!--Inventar-->
					<li class="dropdown">
						<a href="" class="dropdown-toggle" data-toggle="dropdown">Inventar <b class="caret"></b></a>
						<ul class="dropdown-menu">
							
							<li><a href="rohstoffe.html">Material</a></li>
							<li><a href="fertigeerzeugnisse.html">Fertige Erzeugnisse</a></li>
							<li><a href="maschinen.html">Maschinen</a></li>
							<li class="divider"></li>	
							<li><a href="mitarbeiter.html">Mitarbeiter</a></li>
							<li class="divider"></li>
							<li><a href="marketing.html">Marketing</a></li>
							<li class="divider"></li>
							<li><a href="darlehen.html">Darlehen</a></li>
						</ul>
					</li>
					<li><a id ="ergebnisLetzteRunde" data-toggle="modal" href="#ergebnisLetzteRundeModal" onclick="ladeErgebnisLetzteRunde()"></a></li>        
				</ul>

				<ul class="nav navbar-nav navbar-right">
					<!--<li><a href="#about">Zeit: 00:00</a></li>-->
					<li ><a id="spielerName">Unternehmen: </a></li>					
					<!--  <li><img src="img/account.svg"></img></li>-->
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="img/account.svg"></img> <b class="caret"></b></a>
						<ul class="dropdown-menu">
						
							<li><a id="runde">Runde: </a></li>
							<li><a href="#budget" id="kapitalContent">Kapital: </a></li>

							<li class="divider"></li>		
							<li><a class="btn float-right" onclick="beendeZug()" data-toggle="modal">Zug beenden</a> </li>
							
						</ul>
					</li>        
				</ul>
			</div><!--/.nav-collapse -->
		</div>       
    </div>

    <!-- Modal -->
        <div class="modal fade" id="modalContentZugBeenden" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">Hinweis</h4>
              </div>
              <div class="modal-body">
                <h2>Der nächste Spieler ist in 30 Sekunden an der Reihe!</h2>
                    <br>
                    <p>Viel Erfolg!</p>
              </div>
            </div>

          </div>
        </div>

            <!-- Modal -->
        <div class="modal fade" id="ergebnisLetzteRundeModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Hinweis</h4>
              </div>
              <div class="modal-body">
                <h2>Dein Ergebnis der letzten Runde</h2>
                    <br>
                    <table class="table table-bordered table-sm m-0">
                    <tbody>
                        <tr>
                        	<th class="col-sm-1">Einnahmen</th>
                            <td id="einnahmen"> </td>
                        </tr>
                        <tr>
                        	<th class="col-sm-1">Ausgaben</th>
                            <td id="ausgaben"> </td>
                        </tr>
                        <tr>
                            <th class="col-sm-1">Kapital</th>
                            <td id="kapital"> </td>
                        </tr>
                        <tr>
                        	<th class="col-sm-1">Marketingmaßnahmen</th>
                            <td id="marketingMaßnahmen"></td>
                        </tr>
                        <tr>
                        	<th class="col-sm-1">Mitarbeiteranzahl</th>
                            <td id="mitarbeiterAnzahl"></td>
                        </tr>
                    </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>



</body>